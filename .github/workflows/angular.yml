name: Angular

on:
  workflow_call:

jobs:
  build:
    name: Build ⚒️
    uses: ./.github/workflows/angular.build.yml
    with:
      out_dir: dist/${{ github.event.repository.name }}

  test:
    name: Test 🧪
    needs: [build]
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
    uses: ./.github/workflows/angular.test.yml

  lint:
    name: Lint 🧹
    needs: [build]
    uses: ./.github/workflows/angular.lint.yml

  pages:
    name: Pages 🚀
    if: github.ref == 'refs/heads/main'
    needs: [build, test, lint]
    uses: ./.github/workflows/angular.pages.deploy.yml

  docker:
    name: Docker 🐳
    if: startsWith(github.ref, 'refs/tags/') || github.ref == 'refs/heads/main'
    needs: [build, test, lint]
    uses: ./.github/workflows/angular.docker.yml
    secrets: inherit

  release:
    name: Release 🚢
    if: startsWith(github.ref, 'refs/tags/')
    needs: [build, test, lint]
    uses: ./.github/workflows/angular.release.yml
