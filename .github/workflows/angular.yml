name: Angular

on:
  workflow_call:

jobs:
  build:
    name: Build ⚒️
    uses: ./.github/workflows/angular.build.yml
    with:
      out_dir: dist/${{ github.event.repository.name }}

  test:
    name: Test 🧪
    needs: [build]
    # strategy:
    #   matrix:
    #     os: [ubuntu-latest, windows-latest, macos-latest]
    uses: ./.github/workflows/angular.test.yml

  lint:
    name: Lint 🧹
    needs: [build]
    uses: ./.github/workflows/angular.lint.yml

  deploy:
    name: Deploy 🚀
    needs: [build, test, lint]
    if: github.ref == 'refs/heads/main'
    uses: ./.github/workflows/angular.pages.deploy.yml

  build-docker:
    name: Build 🐋⚒️
    needs: [build, test, lint]
    if: github.ref == 'refs/heads/main'
    uses: ./.github/workflows/angular.docker.build.yml

  deploy-docker:
    name: Deploy Docker 🐳🚀
    needs: [build, test, lint]
    if: github.ref == 'refs/heads/main'
    uses: ./.github/workflows/angular.docker.deploy.yml
    secrets: inherit

  release:
    if: startsWith(github.ref, 'refs/tags/')
    needs: [build, test, lint]
    name: Release 🚢
    uses: ./.github/workflows/angular.release.yml
